\begin{appendix}


\chapter{Code Listings}

Code zum Testen der Performance MongoDB vs Microservice

\begin{lstlisting}[language=Ruby]
mongoid_results_count  = []
mongoid_results_select = []
prophet_results_count  = []
prophet_results_select = []

seventy_five_zips = ["24943", "24944", "24945", "24946", "24947",
    "24948", "24949", "24950", "24951", "24952", "24953", "24954",
    "24955", "24956", "24957", "24958", "24959", "24960", "24961",
    "24962", "24963", "24964", "24965", "24966", "24967", "24968",
    "24969", "24970", "24971", "24972", "24973", "24974", "24975",
    "24976", "24977", "24978", "24979", "24980", "24981", "24982",
    "24983", "24984", "24985", "24986", "24987", "24988", "24989",
    "24990", "24991", "24992", "24993", "24994", "24995", "24996",
    "24997", "24998", "24999", "25000", "25001", "25002", "25003",
    "25004", "25005", "25006", "25007", "25008", "25009", "25010",
    "25011", "25012", "25013", "25014", "25015", "25016", "25017"]
    
three_hundred_zips = ["24943", "24944", "24945", "24946", "24947",
    "24948", "24949", "24950", "24951", "24952", "24953", "24954",
    "24955", "24956", "24957", "24958", "24959", "24960", "24961",
    "24962", "24963", "24964", "24965", "24966", "24967", "24968",
    "24969", "24970", "24971", "24972", "24973", "24974", "24975",
    "24976", "24977", "24978", "24979", "24980", "24981", "24982",
    "24983", "24984", "24985", "24986", "24987", "24988", "24989",
    "24990", "24991", "24992", "24993", "24994", "24995", "24996",
    "24997", "24998", "24999", "25000", "25001", "25002", "25003",
    "25004", "25005", "25006", "25007", "25008", "25009", "25010",
    "25011", "25012", "25013", "25014", "25015", "25016", "25017",
    "25018", "25019", "25020", "25021", "25022", "25023", "25024",
    "25025", "25026", "25027", "25028", "25029", "25030", "25031",
    "25032", "25033", "25034", "25035", "25036", "25037", "25038",
    "25039", "25040", "25041", "25042", "25043", "25044", "25045",
    "25046", "25047", "25048", "25049", "25050", "25051", "25052",
    "25053", "25054", "25055", "25056", "25057", "25058", "25059",
    "25060", "25061", "25062", "25063", "25064", "25065", "25066",
    "25067", "25068", "25069", "25070", "25071", "25072", "25073",
    "25074", "25075", "25076", "25077", "25078", "25079", "25080",
    "25081", "25082", "25083", "25084", "25085", "25086", "25087", 
    "25088", "25089", "25090", "25091", "25092", "25093", "25094",
    "25095", "25096", "25097", "25098", "25099", "25100", "25101",
    "25102", "25103", "25104", "25105", "25106", "25107", "25108",
    "25109", "25110", "25111", "25112", "25113", "25114", "25115",
    "25116", "25117", "25118", "25119", "25120", "25121", "25122",
    "25123", "25124", "25125", "25126", "25127", "25128", "25129",
    "25130", "25131", "25132", "25133", "25134", "25135", "25136",
    "25137", "25138", "25139", "25140", "25141", "25142", "25143",
    "25144", "25145", "25146", "25147", "25148", "25149", "25150",
    "25151", "25152", "25153", "25154", "25155", "25156", "25157",
    "25158", "25159", "25160", "25161", "25162", "25163", "25164",
    "25165", "25166", "25167", "25168", "25169", "25170", "25171",
    "25172", "25173", "25174", "25175", "25176", "25177", "25178",
    "25179", "25180", "25181", "25182", "25183", "25184", "25185",
    "25186", "25187", "25188", "25189", "25190", "25191", "25192",
    "25193", "25194", "25195", "25196", "25197", "25198", "25199",
    "25200", "25201", "25202", "25203", "25204", "25205", "25206",
    "25207", "25208", "25209", "25210", "25211", "25212", "25213",
    "25214", "25215", "25216", "25217", "25218", "25219", "25220",
    "25221", "25222", "25223", "25224", "25225", "25226", "25227",
    "25228", "25229", "25230", "25231", "25232", "25233", "25234",
    "25235", "25236", "25237", "25238", "25239", "25240", "25241",
    "25242"]

selectors = [
    { 
        :"profile.lifestyle.lifestyle_eu_birthplace.value"=>"yes",
        :"profile.education.highest_degree.value"=>"abitur" 
    },
    { 
        :"id" => "560149a622f009176300004f" 
    },
    { 
        :"profile.basic.zip_code.value".in => seventy_five_zips 
    },
    { 
        :"profile.basic.zip_code.value".in => three_hundred_zips
    },
    { 
        :"profile.basic.zip_code.value".in => seventy_five_zips,
        :"profile.lifestyle.lifestyle_eu_birthplace.value"=>"yes", 
        :"profile.education.highest_degree.value"=>"abitur" 
    },
    { 
        :"profile.basic.zip_code.value".in => three_hundred_zips,
        :"profile.lifestyle.lifestyle_eu_birthplace.value"=>"yes", 
        :"profile.education.highest_degree.value"=>"abitur" 
    },
    { 
        :"profile.basic.born_at.value" => Date.new(1989, 10, 30) 
    },
    { 
        :"id".ne => "560149a622f009176300004f" 
    },
    { 
        :"id".ne => nil
    }
]

selectors.each do |selector|
  puts "MongoidQuerier count"
  timing = Benchmark.measure do
    100.times do
      mq = MongoidQuerier.new(selector, nil)
      mq.population
    end
  end

  puts timing
  mongoid_results_count.push(timing)

  puts "MongoidQuerier pluck"
  timing = Benchmark.measure do
    100.times do
      mq = MongoidQuerier.new(selector, nil)
      mq.response_rates
    end
  end

  puts timing
  mongoid_results_select.push(timing)

  puts "ProphetQuerier count"
  timing = Benchmark.measure do
    100.times do
      pq = ProphetQuerier.new(selector)
      pq.population
    end
  end

  puts timing
  prophet_results_count.push(timing)

  puts "ProphetQuerier pluck"
  timing = Benchmark.measure do
    100.times do
      pq = ProphetQuerier.new(selector)
      pq.response_rates
    end
  end

  puts timing
  prophet_results_select.push(timing)
end

\end{lstlisting}

\end{appendix}
